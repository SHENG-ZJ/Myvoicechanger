name: Build Mac App (Compatible)

on: workflow_dispatch

jobs:
  build:
    # 强制使用 macOS 13 (Intel)，确保所有 Mac 都能运行
    runs-on: macos-13

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        pip install -r requirement.txt

    - name: Build with PyInstaller
      run: |
        python build.py

    # 自动给文件加可执行权限 (在打包前先修好)
    - name: Fix Permissions
      run: |
        chmod +x dist/VoiceChanger/VoiceChanger

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Mac变声器(文件夹版)
        path: dist/VoiceChanger/  # 上传整个文件夹
